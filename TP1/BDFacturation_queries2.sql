-- 1-Donner les pays dans lesquels se trouvent des clients de catégorie 1 ou 2.-- Trier-les par ordre alphabétique.SELECT DISTINCT PAYSFROM CLIENTSWHERE CATEGORIE = 1 OR CATEGORIE = 2ORDER BY PAYS ASC;-- 2-Donner la référence des produits qui ont été commandés en quantité 15 ou en quantité 20.-- Trier-les par ordre décroissant.SELECT DISTINCT REF_PRODUITFROM DETAILS_COMMANDESWHERE QUANTITE = 15 OR QUANTITE = 20ORDER BY REF_PRODUIT DESC;-- 3-Donner la référence des produits qui ont été commandés en quantité 15 et en quantité 20.-- Donner 2 écritures.SELECT DISTINCT REF_PRODUITFROM DETAILS_COMMANDESWHERE QUANTITE = 15 INTERSECTSELECT DISTINCT REF_PRODUITFROM DETAILS_COMMANDESWHERE QUANTITE = 20ORDER BY REF_PRODUIT DESC;-- 4-Donner le code des clients espagnols qui n'ont pas commandé.-- Donner 2 écritures.SELECT CODE_CLIENTFROM CLIENTSWHERE PAYS = 'Espagne'      AND CODE_CLIENT NOT IN (      	  	      	     SELECT CODE_CLIENT			     FROM COMMANDES);SELECT CODE_CLIENTFROM CLIENTSWHERE PAYS = 'Espagne'MINUSSELECT CODE_CLIENTFROM COMMANDES;-- 5-Donner le numéro des commandes de aout 2008 des clients-- habitant au Royaume-Uni ou à Toulouse.-- Afficher le jour de la commande.SELECT NO_COMMANDE, TO_CHAR(DATE_COMMANDE, 'DD')FROM COMMANDES NATURAL JOIN CLIENTSWHERE TO_CHAR(DATE_COMMANDE, 'MM/YYYY') = '08/2008';-- 6-Donner le code et le pays des clients ayant commandé le produit n°31.-- Afficher le pays sous cette forme : Aut. (3 premières lettres + point).SELECT CODE_CLIENT, PAYSFROM CLIENTS NATURAL JOIN COMMANDES NATURAL JOIN DETAILS_COMMANDESWHERE REF_PRODUIT = '31';-- 7-Donner le code et la société des clients de catégorie 1 avec le numéro de leurs commandes-- (on veut afficher tous les clients même ceux qui n'ont pas encore de commande).-- Trier les lignes par numéro de commande.SELECT CLIENTS.CODE_CLIENT, COMMANDES.NO_COMMANDEFROM CLIENTS LEFT JOIN COMMANDESON CLIENTS.CODE_CLIENT = COMMANDES.CODE_CLIENTORDER BY COMMANDES.NO_COMMANDE;-- 8-Requête 4 avec une jointure externe (anti-jointure).   -- 4-Donner le code des clients espagnols qui n'ont pas commandé.SELECT DISTINCT CLIENTS.CODE_CLIENTFROM CLIENTS LEFT JOIN COMMANDESON CLIENTS.CODE_CLIENT = COMMANDES.CODE_CLIENTWHERE CLIENTS.PAYS = 'Espagne' AND COMMANDES.NO_COMMANDE IS NULL;-- 9-Requête 4 avec un NOT EXISTS.SELECT CODE_CLIENTFROM CLIENTSWHERE PAYS = 'Espagne'      AND NOT EXISTS (      	  SELECT NO_COMMANDE      	  FROM COMMANDES	  WHERE CODE_CLIENT = CLIENTS.CODE_CLIENT);-- 10-Donner la référence des produits dont le nom contient 'Sauce'-- ou qui ont été commandé avec une quantité comprise entre 50 et 60.SELECT DISTINCT REF_PRODUITFROM DETAILS_COMMANDES NATURAL JOIN PRODUITSWHERE NOM_PRODUIT LIKE '%Sauce%' OR (QUANTITE >= 50 AND QUANTITE <= 60);-- 11-Donner les produits commandés en même quantité dans une même commande-- (uniquement si la quantité est supérieure à 45).-- SELECT *-- FROM DETAILS_COMMANDES DC1-- WHERE QUANTITE > 45 AND DC1.QUANTITE = (--        SELECT DC2.QUANTITE--        FROM DETAILS_COMMANDES DC2--        WHERE DC1.NO_COMMANDE = DC2.NO_COMMANDES--        	     AND DC1.REF_PRODUIT != DC2.REF_PRODUIT-- 	     AND DC2.QUANTITE = DC1.QUANTITE);SELECT *FROM DETAILS_COMMANDES DC1 JOIN  DETAILS_COMMANDES DC2 ON DC1.NO_COMMANDE = DC2.NO_COMMANDEWHERE DC1.QUANTITE > 45 AND DC1.QUANTITE = DC2.QUANTITE AND DC1.REF_PRODUIT < DC2.REF_PRODUIT;-- 12-Donner pour chaque produit, les produits qui coutent 10€ de plus.-- Afficher les références et les prix des produits-- Trier par produit.SELECT P1.REF_PRODUIT, P1.PRIX_UNITAIRE, P2.REF_PRODUIT, P2.PRIX_UNITAIREFROM PRODUITS P1 JOIN PRODUITS P2 ON P1.REF_PRODUIT != P2.REF_PRODUITWHERE P2.PRIX_UNITAIRE = P1.PRIX_UNITAIRE + 10ORDER BY P1.REF_PRODUIT;-- 13-Donner le nombre de clients qui ont commandé le produit n° 31.SELECT COUNT(DISTINCT CODE_CLIENT)FROM COMMANDES NATURAL JOIN DETAILS_COMMANDESWHERE REF_PRODUIT = 31;-- 14-Donner la référence et le nom du ou des produits les plus chers.SELECT REF_PRODUIT, NOM_PRODUITFROM PRODUITSWHERE PRIX_UNITAIRE = (      SELECT MAX(PRIX_UNITAIRE)      FROM PRODUITS);-- 15-Donner le nombre de clients de catégorie 0 ou 1 par pays (sauf la France).-- Trier par nombre décroissant.SELECT PAYS, COUNT(CODE_CLIENT)FROM CLIENTSWHERE (CATEGORIE = 0 OR CATEGORIE = 1) AND PAYS != 'France'GROUP BY PAYSORDER BY COUNT(CODE_CLIENT) DESC;-- 16-Donner le nombre de clients par pays et par catégorie.-- Trier par pays, catégorie.SELECT PAYS, CATEGORIE, COUNT(CODE_CLIENT)FROM CLIENTSGROUP BY PAYS, CATEGORIEORDER BY PAYS, CATEGORIE;-- 17-Donner les pays ayant des sociétés d'au moins 2 catégories différentes.SELECT PAYSFROM CLIENTSGROUP BY PAYSHAVING COUNT(DISTINCT CATEGORIE) >= 2;-- 18-Donner le nombre de produits total par commande (uniquement si au moins 4 références différentes).SELECT SUM(QUANTITE)FROM DETAILS_COMMANDESGROUP BY NO_COMMANDEHAVING COUNT(REF_PRODUIT) >= 4;-- 19-Donner la référence des commandes dont le montant est supérieur à 20000-- (afficher le montant total de la facture).-- Vérifier le résultat pour une facture.SELECT NO_COMMANDE, SUM(PRIX_UNITAIRE * QUANTITE)FROM DETAILS_COMMANDES NATURAL JOIN PRODUITSGROUP BY NO_COMMANDEHAVING SUM(PRIX_UNITAIRE * QUANTITE) > 20000;-- 20-Donner le numéro et la date des commandes avec au moins 4 références différentes.SELECT NO_COMMANDE, DATE_COMMANDEFROM COMMANDES NATURAL JOIN DETAILS_COMMANDESGROUP BY NO_COMMANDE, DATE_COMMANDEHAVING COUNT(DISTINCT REF_PRODUIT) >= 4;-- 21-Donner le numéro des commandes contenant tous les produits qui coutent 105€.SELECT NO_COMMANDEFROM DETAILS_COMMANDES NATURAL JOIN PRODUITSWHERE PRIX_UNITAIRE = 105GROUP BY NO_COMMANDEHAVING COUNT(REF_PRODUIT) = (SELECT COUNT(*)       			     FROM PRODUITS			     WHERE PRIX_UNITAIRE = 105);-- 22-Donner la référence des produits qui sont dans toutes les commandes de ERNSH.SELECT NO_COMMANDE, REF_PRODUITFROM COMMANDES NATURAL JOIN DETAILS_COMMANDESWHERE CODE_CLIENT = 'ERNSH'GROUP BY NO_COMMANDE, REF_PRODUIT;-- Ne fonctionne pas-- 23-Donner la référence du produit qui a été le plus commandé.--SELECT REF_PRODUIT FROM DETAILS_COMMANDES GROUP BY REF_PRODUIT;-- 24-Donner le numéro des commandes de 2010 (avec le code des clients) contenant tous les produits les plus chers.--SELECT NO_COMMANDE